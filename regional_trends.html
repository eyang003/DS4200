<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional Trends</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- header -->
    <header>
        <h1>How Climate Change Impacts Agriculture</h1>
        <p>Exploring global and regional trends, and the effectiveness of adaptation strategies.</p>
    </header>

    <!-- navigation -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="the_problem.html">The Problem</a></li>
            <li><a href="regional_trends.html">Regional Analysis</a></li>
            <li><a href="adaptation_strategies.html">Adaptation Strategies</a></li>
            <li><a href="https://github.com/eyang003/DS4200" target="_blank" class="github-btn">Visit our GitHub Repo!</a></li>
        </ul>
    </nav>

    <main>
        <section>
            <h2>Country Crop Yields Over Time</h2>
            <p>To help us identify possible climate change factors affecting crop yields, we started by identifying countries that have seen the most/least
                improvement in crop yields from 1990 - 2024. The graph below calculates the average crop yield for a country in 1990 compared to 2024 and we identified
                the top 3 countries being Brazil, China, and Russia whereas the bottom 3 were Argentina, Russia, and the USA.</p>
            <img src="plots/country_crop_yields.png" alt="Countries with most and least increase in crop yields">
        </section>

        <section>
            <h2>Regional Analysis: CO2 Emissions vs Crop Yields</h2>
            <p>This section visualizes the relationship between CO2 emissions and crop yields for different regions, specifically focusing on Nigeria and Russia. The D3 plot below shows how changes in CO2 emissions correlate with crop yields in these countries over time.</p>
            <!-- div where D3 plot will be rendered -->
            <div id="scatterPlot"></div>
            <div id="legend"></div>
        </section>

    </main>

    <footer>
        <button onclick="window.location.href='index.html'">Back to Home</button>
    </footer>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // d3 plot
        d3.json("https://eyang003.github.io/DS4200/nigeria_russia_data.json")
            .then(function(data) {
                // filter data for Nigeria and Russia
                const nigeria_russia_data = data.filter(d => d.Country === "Nigeria" || d.Country === "Russia");

                const width = 800, height = 400;

                // create SVG element
                const svg = d3.select("#scatterPlot")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                    const xScale = d3.scaleLinear()
                    .domain([0, d3.max(nigeria_russia_data, d => +d.CO2_Emissions_MT)])
                    .range([50, width - 50]);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(nigeria_russia_data, d => +d.Crop_Yield_MT_per_HA)])
                    .range([height - 50, 50]);

                const colorScale = d3.scaleOrdinal()
                    .domain(["Nigeria", "Russia"])
                    .range(["green", "orange"]);

                // add axes
                svg.append("g")
                    .attr("transform", `translate(0,${height - 50})`)
                    .call(d3.axisBottom(xScale));

                svg.append("g")
                    .attr("transform", "translate(50, 0)")
                    .call(d3.axisLeft(yScale));
                
                // axis labels
                svg.append("text")
                    .attr("transform", `translate(${width / 2}, ${height - 10})`)
                    .style("text-anchor", "middle")
                    .text("CO2 Emissions (MT)");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", 20)
                    .style("text-anchor", "middle")
                    .text("Crop Yield (MT per HA)");

                // scatter plot: CO2 Emissions vs Crop Yield
                svg.selectAll("circle")
                    .data(nigeria_russia_data)
                    .enter()
                    .append("circle")
                    .attr("cx", d => xScale(+d.CO2_Emissions_MT))
                    .attr("cy", d => yScale(+d.Crop_Yield_MT_per_HA))
                    .attr("r", 8)
                    .attr("fill", d => colorScale(d.Country))
                    .on("mouseover", (event, d) => {
                        d3.select(".tooltip")
                            .style("opacity", 1)
                            .html(`Country: ${d.Country}<br>CO2 Emissions: ${d.CO2_Emissions_MT}<br>Crop Yield: ${d.Crop_Yield_MT_per_HA}`)
                            .style("left", `${event.pageX + 5}px`)
                            .style("top", `${event.pageY - 28}px`);
                    })
                    .on("mouseout", () => {
                        d3.select(".tooltip")
                            .style("opacity", 0);
                    });

                // Tooltip
                d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

                // add legend
                const legend = d3.select("#legend").append("svg")
                    .attr("width", 200)
                    .attr("height", 100);

                const legendItems = [
                    { country: "Nigeria", color: "green" },
                    { country: "Russia", color: "orange" }
                ];

                const legendGroup = legend.selectAll("g")
                    .data(legendItems)
                    .enter().append("g")
                    .attr("transform", (d, i) => `translate(0, ${i * 25})`);

                legendGroup.append("rect")
                    .attr("width", 20)
                    .attr("height", 20)
                    .attr("fill", d => d.color);

                legendGroup.append("text")
                    .attr("x", 30)
                    .attr("y", 15)
                    .text(d => d.country)
                    .style("font-size", "14px")
                    .attr("alignment-baseline", "middle");
            })
            .catch(function(error) {
                console.log("Error loading the JSON: ", error);
            });
    </script>
</body>
</html>
